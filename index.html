<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Aplicaciones Educativas con IA</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilo base para usar la fuente Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para el spinner de carga */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center justify-center p-4">

    <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-3xl border border-gray-200">
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-cyan-600 mb-2">Analizador de Aplicaciones Educativas con IA</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">
                Introduce tus datos y la URL o descripción de una aplicación. La IA la analizará y preparará un borrador en tu formulario de Google con todos los campos deducidos.
            </p>
        </div>

        <form id="analisisForm" class="space-y-6">
            <div>
                <label for="authorName" class="block text-sm font-medium text-gray-700 mb-1">Nombre de autor/a o alias. Si hay más de un autor/a, sepáralos por comas.</label>
                <input type="text" id="authorName" name="authorName" class="w-full bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-900 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Ej: Juan Pérez">
            </div>
             <div>
                <label for="platformSelect" class="block text-sm font-medium text-gray-700 mb-1">Plataforma de creación</label>
                <select id="platformSelect" name="platformSelect" class="w-full bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-900 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                    <option value="" disabled selected>Selecciona una plataforma</option>
                    <option value="Canva">Canva</option>
                    <option value="Claude">Claude</option>
                    <option value="ChatGPT">ChatGPT</option>
                    <option value="Copilot">Copilot</option>
                    <option value="DeepSeek">DeepSeek</option>
                    <option value="Gemini">Gemini</option>
                    <option value="Google AI Studio">Google AI Studio</option>
                    <option value="Grok">Grok</option>
                    <option value="Lovable.app">Lovable.app</option>
                    <option value="Netlify">Netlify</option>
                    <option value="Qwen">Qwen</option>
                    <option value="Replit">Replit</option>
                    <option value="Websim">Websim</option>
                    <option value="Otra">Otra</option>
                </select>
            </div>
            
            <div id="urlInputContainer">
                <label for="appUrl" class="block text-sm font-medium text-gray-700 mb-1">URL de la aplicación</label>
                <input type="url" id="appUrl" name="appUrl" class="w-full bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-900 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="https://ejemplo.com/mi-aplicacion">
            </div>

            <div>
                <div class="flex items-center space-x-1.5 mb-2">
                    <label class="block text-sm font-medium text-gray-700">Fuente del análisis</label>
                    <div class="group relative flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-cyan-600 cursor-help">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs scale-0 rounded bg-gray-800 p-2 text-xs text-white group-hover:scale-100 transition-all duration-200 origin-bottom z-10">
                            Se recomienda copiar y pegar el código fuente para que la aplicación haga su propia descripción.
                        </span>
                    </div>
                </div>
                <div class="flex space-x-2 border border-gray-200 rounded-md p-1">
                    <button type="button" id="modeTextBtn" class="flex-1 p-2 rounded-md text-sm font-semibold transition">Descripción / Código</button>
                    <button type="button" id="modeUrlBtn" class="flex-1 p-2 rounded-md text-sm font-semibold transition">Solo URL</button>
                </div>
            </div>
            
            <div id="descriptionInputContainer" class="hidden">
                 <label for="appDescription" class="block text-sm font-medium text-gray-700 mb-1">Descripción o código fuente a analizar</label>
                 <textarea id="appDescription" name="appDescription" rows="5" class="w-full bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-900 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Pega aquí una descripción detallada de la aplicación o su código fuente..."></textarea>
            </div>
            
            <button type="submit" id="analizarBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-md transition-all duration-300 flex items-center justify-center space-x-2 disabled:bg-cyan-800 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                <span>Analizar con IA</span>
            </button>
        </form>

        <div id="statusArea" class="mt-6 text-center h-16 flex flex-col items-center justify-center">
             <p id="statusMessage" class="text-gray-600"></p>
             <div id="resultArea" class="hidden mt-2">
                <a id="openFormLink" href="#" target="_blank" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition-all duration-300 inline-flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right-from-square"><path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"/><path d="m21 3-9 9"/><path d="M15 3h6v6"/></svg>
                    <span>Abrir Formulario Rellenado</span>
                </a>
             </div>
        </div>
    </main>

    <footer class="text-center mt-8 text-sm text-gray-500">
        <p><a href="https://t.me/vceduca" target="_blank" rel="noopener noreferrer" class="hover:text-cyan-600 transition">Vibe Coding Educativo</a></p>
        <p class="mt-2">
            <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener noreferrer" class="hover:text-cyan-600 transition">Licencia GPL v3</a>
        </p>
    </footer>


    <script type="module">
        // --- CONFIGURACIÓN ---
        const GOOGLE_FORM_CONFIG = {
            formId: "1FAIpQLSdYIuawJTmEtCCNVusErNszuWIfc-hAL1Zy-gtgNYhmr4wYTA",
            fieldIds: {
                autor: "entry.2027879855",
                titulo: "entry.1936764678",
                url: "entry.927393209",
                descripcion: "entry.1687157750",
                palabrasClave: "entry.1849932620",
                tipoRecurso: "entry.1975186150",
                nivelEducativo: "entry.1339686242",
                areaConocimiento: "entry.1763651912",
                plataforma: "entry.837026772"
            }
        };
        
        // --- DOM & ESTADO ---
        const form = document.getElementById('analisisForm');
        const authorInput = document.getElementById('authorName');
        const platformSelect = document.getElementById('platformSelect');
        const urlInput = document.getElementById('appUrl');
        const urlInputLabel = document.querySelector('#urlInputContainer label');
        const descriptionInput = document.getElementById('appDescription');
        const submitButton = document.getElementById('analizarBtn');
        const statusMessage = document.getElementById('statusMessage');
        const resultArea = document.getElementById('resultArea');
        const openFormLink = document.getElementById('openFormLink');
        const modeUrlBtn = document.getElementById('modeUrlBtn');
        const modeTextBtn = document.getElementById('modeTextBtn');
        const urlInputContainer = document.getElementById('urlInputContainer');
        const descriptionInputContainer = document.getElementById('descriptionInputContainer');

        let analysisMode = 'text'; // 'url' o 'text'

        // --- LÓGICA DE LA INTERFAZ Y DATOS LOCALES ---
        function setAnalysisMode(mode) {
            analysisMode = mode;
            
            if (mode === 'url') {
                descriptionInputContainer.classList.add('hidden');
                modeUrlBtn.classList.add('bg-cyan-600', 'text-white');
                modeUrlBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modeTextBtn.classList.add('bg-gray-200', 'text-gray-700');
                modeTextBtn.classList.remove('bg-cyan-600', 'text-white');
                descriptionInput.required = false;
                urlInput.required = true;
                urlInputLabel.textContent = "URL de la aplicación";
            } else { // mode 'text'
                descriptionInputContainer.classList.remove('hidden');
                modeTextBtn.classList.add('bg-cyan-600', 'text-white');
                modeTextBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modeUrlBtn.classList.add('bg-gray-200', 'text-gray-700');
                modeUrlBtn.classList.remove('bg-cyan-600', 'text-white');
                descriptionInput.required = true;
                urlInput.required = false; // URL es opcional en modo texto pero se enviará si existe
                urlInputLabel.textContent = "URL de la aplicación";
            }
        }

        modeUrlBtn.addEventListener('click', () => setAnalysisMode('url'));
        modeTextBtn.addEventListener('click', () => setAnalysisMode('text'));
        
        window.addEventListener('load', () => {
            const savedAuthor = localStorage.getItem('authorName');
            if (savedAuthor) authorInput.value = savedAuthor;
            
            const savedPlatform = localStorage.getItem('creationPlatform');
            if (savedPlatform) platformSelect.value = savedPlatform;

            setAnalysisMode('text'); // Iniciar en modo Descripción / Código por defecto
        });

        authorInput.addEventListener('input', () => localStorage.setItem('authorName', authorInput.value));
        platformSelect.addEventListener('change', () => localStorage.setItem('creationPlatform', platformSelect.value));
        
        // Autoseleccionar plataforma a partir de la URL
        urlInput.addEventListener('input', () => {
            const url = urlInput.value.toLowerCase();
            if (!url) return;

            const platformDomainMap = {
                'ChatGPT': 'openai.com',
                'Copilot': 'copilot.microsoft.com',
                'Gemini': 'gemini.google.com',
                'Google AI Studio': 'aistudio.google.com',
                'Lovable.app': 'lovable.app',
                'Netlify': '.netlify.app',
                'Replit': 'replit.com'
            };

            for (const option of platformSelect.options) {
                if (option.value === 'Otra') continue;
                
                const platformName = option.value;
                const searchTerm = (platformDomainMap[platformName] || platformName).toLowerCase();
                
                if (url.includes(searchTerm)) {
                    platformSelect.value = platformName;
                    platformSelect.dispatchEvent(new Event('change'));
                    break;
                }
            }
        });


        // --- LÓGICA PRINCIPAL DEL ANÁLISIS ---
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const author = authorInput.value.trim();
            const platform = platformSelect.value;
            const urlToAnalyze = urlInput.value.trim();
            const descriptionToAnalyze = descriptionInput.value.trim();

            let sourceContent;

            if (analysisMode === 'url') {
                if (!urlToAnalyze) {
                    updateStatus('Por favor, introduce una URL válida.', 'error');
                    return;
                }
                sourceContent = `la página web en la URL: ${urlToAnalyze}`;
            } else { // modo 'text'
                if (!descriptionToAnalyze) {
                    updateStatus('Por favor, introduce una descripción o código fuente.', 'error');
                    return;
                }
                sourceContent = `el siguiente texto, que puede ser una descripción o el código fuente de una aplicación:\n\n---\n${descriptionToAnalyze}\n---`;
                if (urlToAnalyze) {
                    sourceContent += `\nLa URL de referencia es: ${urlToAnalyze}`;
                }
            }
            
            setLoadingState(true);
            resultArea.classList.add('hidden'); 
            updateStatus('Contactando con la IA para analizar...', 'loading');

            try {
                const prompt = \`Como experto en catalogación de tecnología educativa, analiza \${sourceContent}.
                Extrae la siguiente información y respóndela en un objeto JSON válido con las claves especificadas:

                1.  "titulo": Un título conciso y atractivo para la aplicación.
                2.  "descripcion": Una descripción breve (2-3 frases) que resuma su propósito educativo y cómo funciona. Si la fuente es código, deduce la funcionalidad. Si es una descripción, mejórala y resúmela.
                3.  "palabrasClave": Un string con 3 a 5 palabras clave relevantes, separadas por comas.
                4.  "tipoRecurso": Un array con uno o más tipos de recurso aplicables. Elige de la lista: ["Juego / Gamificación", "Simulador / Laboratorio virtual", "Cuestionario / Test / Evaluación", "Tutorial / Guía paso a paso", "Herramienta de creación", "Presentación / Infografía interactiva", "Asistente / Tutor con IA", "Colección / Repositorio / Biblioteca", "Visualización de datos / Mapa interactivo", "Otro"].
                5.  "nivelEducativo": Un array con uno o más niveles educativos. Elige de la lista: ["Infantil", "Primaria", "Secundaria", "Bachillerato", "Formación Profesional", "Universidad", "Formación para Adultos / Autoaprendizaje", "Formación del profesorado"].
                6.  "areaConocimiento": Un array con una o más áreas de conocimiento. Elige de la lista: ["Ciencia y Tecnología", "Pensamiento Lógico-Matemático", "Lenguaje y Comunicación", "Ciencias Sociales y Cívicas", "Artes y Humanidades", "Desarrollo Personal y Social", "Recursos para la docencia y la organización", "Idiomas"].

                Responde únicamente con el objeto JSON. No incluyas texto adicional antes o después.\`;
                
                const schema = {
                    type: "OBJECT", properties: { "titulo": { "type": "STRING" }, "descripcion": { "type": "STRING" }, "palabrasClave": { "type": "STRING" }, "tipoRecurso": { "type": "ARRAY", "items": { "type": "STRING" }}, "nivelEducativo": { "type": "ARRAY", "items": { "type": "STRING" }}, "areaConocimiento": { "type": "ARRAY", "items": { "type": "STRING" }} },
                    required: ["titulo", "descripcion", "palabrasClave", "tipoRecurso", "nivelEducativo", "areaConocimiento"]
                };
                
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: schema }};
                const apiKey = ""; // <-- ¡RECUERDA PEGAR TU CLAVE API AQUÍ!
                const apiUrl = \`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=\${apiKey}\`;

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                if (!response.ok) throw new Error(\`Error de la API [\${response.status}]: \${await response.text()}\`);

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                    const aiContent = JSON.parse(result.candidates[0].content.parts[0].text);
                    updateStatus('¡Análisis completado! Haz clic abajo para abrir el formulario.', 'success');
                    const formUrl = buildGoogleFormUrl(aiContent, urlToAnalyze, author, platform);
                    openFormLink.href = formUrl;
                    resultArea.classList.remove('hidden');
                } else {
                    throw new Error("La IA no devolvió un resultado válido o la respuesta está vacía.");
                }

            } catch (error) {
                console.error('Error en el proceso:', error);
                updateStatus(\`Error: \${error.message}. Inténtalo de nuevo.\`, 'error');
            } finally {
                setLoadingState(false);
            }
        });

        // --- FUNCIONES AUXILIARES ---
        function buildGoogleFormUrl(aiData, appUrl, authorName, platform) {
            const baseUrl = \`https://docs.google.com/forms/d/e/\${GOOGLE_FORM_CONFIG.formId}/viewform?usp=pp_url\`;
            const params = new URLSearchParams();
            
            if (aiData.titulo) params.append(GOOGLE_FORM_CONFIG.fieldIds.titulo, aiData.titulo);
            if (aiData.descripcion) params.append(GOOGLE_FORM_CONFIG.fieldIds.descripcion, aiData.descripcion);
            if (aiData.palabrasClave) params.append(GOOGLE_FORM_CONFIG.fieldIds.palabrasClave, aiData.palabrasClave);
            if (appUrl) params.append(GOOGLE_FORM_CONFIG.fieldIds.url, appUrl);
            if (authorName) params.append(GOOGLE_FORM_CONFIG.fieldIds.autor, authorName);
            if (platform) params.append(GOOGLE_FORM_CONFIG.fieldIds.plataforma, platform);
            
            aiData.tipoRecurso?.forEach(item => params.append(GOOGLE_FORM_CONFIG.fieldIds.tipoRecurso, item));
            aiData.nivelEducativo?.forEach(item => params.append(GOOGLE_FORM_CONFIG.fieldIds.nivelEducativo, item));
            aiData.areaConocimiento?.forEach(item => params.append(GOOGLE_FORM_CONFIG.fieldIds.areaConocimiento, item));

            return \`\${baseUrl}&\${params.toString()}\`;
        }
        
        function updateStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.classList.remove('text-green-500', 'text-red-500', 'text-gray-600');
            switch(type) {
                case 'success': statusMessage.classList.add('text-green-500'); break;
                case 'error': statusMessage.classList.add('text-red-500'); break;
                default: statusMessage.classList.add('text-gray-600'); break;
            }
        }
        
        function setLoadingState(isLoading) {
            submitButton.disabled = isLoading;
            const spinner = submitButton.querySelector('.spinner');
            const buttonText = submitButton.querySelector('span');
            if (isLoading) {
                if (!spinner) {
                    const newSpinner = document.createElement('div');
                    newSpinner.className = 'spinner';
                    submitButton.prepend(newSpinner);
                }
                if(buttonText) buttonText.textContent = "Analizando...";
            } else {
                if (spinner) spinner.remove();
                if(buttonText) buttonText.textContent = "Analizar con IA";
            }
        }
    </script>
</body>
</html>
